import{_ as e,I as u,c as p,o as d,j as l,J as t,ah as h,a as n,w as a}from"./chunks/framework.CfFWKSe1.js";const b=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"knowledge/browser/http.md","filePath":"knowledge/browser/http.md"}'),r={name:"knowledge/browser/http.md"};function k(o,s,g,c,T,y){const i=u("Collapse");return d(),p("div",null,[s[11]||(s[11]=l("h3",{id:"_1-http2的首部压缩",tabindex:"-1"},[n("1. http2的首部压缩 "),l("a",{class:"header-anchor",href:"#_1-http2的首部压缩","aria-label":"Permalink to “1. http2的首部压缩”"},"​")],-1)),t(i,null,{default:a(()=>[...s[0]||(s[0]=[l("ul",null,[l("li",null,[l("p",null,"为什么要压缩首部？"),l("ul",null,[l("li",null,"HTTP/1.1 的每个请求都会携带大量重复的首部. 这些头部在同一个连接中 几乎每次都一样，比如 User-Agent、Cookie、Accept。HTTP/2 引入 首部压缩（Header Compression） 来减少这种重复，提高传输效率。")])]),l("li",null,[l("p",null,"HTTP/2 首部压缩机制：HPACK")])],-1),l("table",{tabindex:"0"},[l("thead",null,[l("tr",null,[l("th",null,"机制"),l("th",null,"说明")])]),l("tbody",null,[l("tr",null,[l("td",null,[l("strong",null,"静态表（Static Table）")]),l("td",null,[n("内置常见头部字段，如 "),l("code",null,":method"),n(", "),l("code",null,":path"),n(", "),l("code",null,":status"),n(" 等；用索引代替字符串。")])]),l("tr",null,[l("td",null,[l("strong",null,"动态表（Dynamic Table）")]),l("td",null,"在连接中缓存已发送的头部；后续请求只需引用索引。")]),l("tr",null,[l("td",null,[l("strong",null,"霍夫曼编码（Huffman Encoding）")]),l("td",null,"对字符串部分再进行霍夫曼编码，进一步压缩体积。")])])],-1),l("ul",null,[l("li",null,"HPACK 的压缩原理图")],-1),l("table",{tabindex:"0"},[l("thead",null,[l("tr",null,[l("th",null,"步骤"),l("th",null,"动作"),l("th",null,"效果")])]),l("tbody",null,[l("tr",null,[l("td",null,"1"),l("td",null,"查静态表"),l("td",null,[n("常用字段直接用编号（如 "),l("code",null,":method: GET"),n(" = #2）")])]),l("tr",null,[l("td",null,"2"),l("td",null,"查动态表"),l("td",null,"最近请求过的头字段从表中引用")]),l("tr",null,[l("td",null,"3"),l("td",null,"发送差异数据"),l("td",null,"只发送新字段或变化部分")]),l("tr",null,[l("td",null,"4"),l("td",null,"霍夫曼编码"),l("td",null,"对字符串再压缩")]),l("tr",null,[l("td",null,"✅"),l("td",null,"结果"),l("td",null,"头部数据量可减少 60–90%")])])],-1),l("p",null,[l("strong",null,"HTTP/2 的首部压缩机制（HPACK）通过静态表、动态表和霍夫曼编码三种方式，实现头部字段的高效压缩与重用，大幅减少网络传输开销。")],-1),l("p",null,'HTTP/2 是一个二进制协议。在 HTTP/1.1 版中，报文的头信息必须是文本（ASCII 编码），数据体可以是文本，也可以是二进制。HTTP/2 则是一个彻底的二进制协议，头信息和数据体都是二进制，并且统称为"帧"，可以分为头信息帧和数据帧。 帧的概念是它实现多路复用的基础。',-1)])]),_:1}),s[12]||(s[12]=l("h3",{id:"_2-tcp-断开4次挥手",tabindex:"-1"},[n("2. tcp 断开4次挥手 "),l("a",{class:"header-anchor",href:"#_2-tcp-断开4次挥手","aria-label":"Permalink to “2. tcp 断开4次挥手”"},"​")],-1)),t(i,null,{default:a(()=>[...s[1]||(s[1]=[l("p",null,"TCP 是全双工的. 全双工（Full-duplex）：",-1),l("ul",null,[l("li",null,"即双方可以同时发送和接收数据。"),l("li",null,"所以连接断开时，双方都要单独关闭各自的发送方向。")],-1),l("p",null,"假设：客户端（主动关闭连接）服务器（被动关闭连接）",-1),l("p",null,"通信结束时，断开过程如下：",-1),l("table",{tabindex:"0"},[l("thead",null,[l("tr",null,[l("th",null,"步骤"),l("th",null,"方向"),l("th",null,"报文标志位"),l("th",null,"说明")])]),l("tbody",null,[l("tr",null,[l("td",null,"①"),l("td",null,"客户端 → 服务器"),l("td",null,[l("code",null,"FIN=1")]),l("td",null,"客户端请求关闭发送通道")]),l("tr",null,[l("td",null,"②"),l("td",null,"服务器 → 客户端"),l("td",null,[l("code",null,"ACK=1")]),l("td",null,"服务器确认接收")]),l("tr",null,[l("td",null,"③"),l("td",null,"服务器 → 客户端"),l("td",null,[l("code",null,"FIN=1")]),l("td",null,"服务器也关闭发送通道")]),l("tr",null,[l("td",null,"④"),l("td",null,"客户端 → 服务器"),l("td",null,[l("code",null,"ACK=1")]),l("td",null,"客户端确认接收，进入 TIME_WAIT")])])],-1),l("div",{class:"language-"},[l("button",{title:"Copy Code",class:"copy"}),l("span",{class:"lang"}),l("pre",{class:"shiki shiki-themes github-light github-dark",style:{"--shiki-light":"#24292e","--shiki-dark":"#e1e4e8","--shiki-light-bg":"#fff","--shiki-dark-bg":"#24292e"},tabindex:"0",dir:"ltr"},[l("code",null,[l("span",{class:"line"},[l("span",null,"客户端 (Client)                             服务器 (Server)")]),n(`
`),l("span",{class:"line"},[l("span",null,"------------------                          ------------------")]),n(`
`),l("span",{class:"line"},[l("span")]),n(`
`),l("span",{class:"line"},[l("span",null,"   ESTABLISHED                                  ESTABLISHED")]),n(`
`),l("span",{class:"line"},[l("span",null,"        |                                              |")]),n(`
`),l("span",{class:"line"},[l("span",null,"        | ① FIN=1, seq=u                              |")]),n(`
`),l("span",{class:"line"},[l("span",null,"        |--------------------------------------------->|")]),n(`
`),l("span",{class:"line"},[l("span",null,"        |                                              |")]),n(`
`),l("span",{class:"line"},[l("span",null,"        |                           收到 FIN, 发 ACK=1, ack=u+1")]),n(`
`),l("span",{class:"line"},[l("span",null,"        | ②                                            |")]),n(`
`),l("span",{class:"line"},[l("span",null,"        |<---------------------------------------------|")]),n(`
`),l("span",{class:"line"},[l("span",null,"        |                                              |")]),n(`
`),l("span",{class:"line"},[l("span",null,"        |                           服务器继续处理剩余数据")]),n(`
`),l("span",{class:"line"},[l("span",null,"        |                                              |")]),n(`
`),l("span",{class:"line"},[l("span",null,"        |                           ③ FIN=1, seq=v    |")]),n(`
`),l("span",{class:"line"},[l("span",null,"        |<---------------------------------------------|")]),n(`
`),l("span",{class:"line"},[l("span",null,"        | ④ ACK=1, ack=v+1                             |")]),n(`
`),l("span",{class:"line"},[l("span",null,"        |--------------------------------------------->|")]),n(`
`),l("span",{class:"line"},[l("span",null,"        |                                              |")]),n(`
`),l("span",{class:"line"},[l("span",null,"   TIME_WAIT(等待2MSL)                          CLOSED")]),n(`
`),l("span",{class:"line"},[l("span",null,"        |")]),n(`
`),l("span",{class:"line"},[l("span",null,"   连接彻底关闭")])])])],-1),l("p",null,"客户端最后要 等待 2×MSL（Maximum Segment Lifetime） 时间，约几十秒。",-1),l("p",null,"作用：",-1),l("ul",null,[l("li",null,[l("p",null,"确保服务器收到最终 ACK"),l("ul",null,[l("li",null,"若 ACK 丢失，服务器会重发 FIN。"),l("li",null,"客户端在 TIME_WAIT 状态还能重发 ACK。")])]),l("li",null,[l("p",null,"防止旧连接残余报文影响新连接"),l("ul",null,[l("li",null,"等待 MSL 确保网络中旧包都过期。")])])],-1),l("ol",null,[l("li",null,"为什么关闭要四次，而不是三次？ 因为 TCP 是全双工：")],-1),l("ul",null,[l("li",null,"一方关闭发送，不代表另一方也关闭；"),l("li",null,"必须双方都各自发送 FIN，确认关闭。")],-1),l("ol",{start:"2"},[l("li",null,"为什么客户端要 TIME_WAIT？")],-1),l("p",null,"防止最后的 ACK 丢失，确保连接彻底关闭。 另外，避免旧连接的数据干扰新连接。",-1),l("ol",{start:"3"},[l("li",null,"为什么是 “2MSL”？")],-1),l("p",null,"因为： 一个 MSL 是一个报文在网络中能存活的最长时间； 等 2×MSL，确保往返的所有旧报文都消失。",-1),l("ol",{start:"4"},[l("li",null,"如果服务器先关闭会怎样？")],-1),l("p",null,"流程相同，只是角色对调。 谁主动关闭，谁就经历 TIME_WAIT。",-1)])]),_:1}),s[13]||(s[13]=l("h3",{id:"_3-什么是队头阻塞",tabindex:"-1"},[n("3. 什么是队头阻塞 "),l("a",{class:"header-anchor",href:"#_3-什么是队头阻塞","aria-label":"Permalink to “3. 什么是队头阻塞”"},"​")],-1)),t(i,null,{default:a(()=>[...s[2]||(s[2]=[l("p",null,"队头阻塞就是“队列第一个请求卡住，后面全被拖延”。HTTP/3 通过 QUIC 彻底缓解了这个问题。",-1)])]),_:1}),s[14]||(s[14]=l("h3",{id:"_4-http-2-多路复用",tabindex:"-1"},[n("4. http 2 多路复用 "),l("a",{class:"header-anchor",href:"#_4-http-2-多路复用","aria-label":"Permalink to “4. http 2 多路复用”"},"​")],-1)),t(i,null,{default:a(()=>[...s[3]||(s[3]=[l("p",null,"HTTP/1.1 每个请求都必须建立在一个 TCP 连接上。虽然它支持“Keep-Alive”长连接，但仍然有两个性能瓶颈：",-1),l("ul",null,[l("li",null,"队头阻塞（Head-of-Line Blocking）: 一个连接中，请求是串行执行的。前一个响应没回来，后面的请求必须等。"),l("li",null,"多连接并发受限: 浏览器为同一域名通常只能同时开 6 个 TCP 连接，多了也被限制。"),l("li",null,"📦 头部重复传输: 每次请求都要携带大量相同的 Header（如 cookie、user-agent）。")],-1),l("p",null,"在一个 TCP 连接上，同时并发多个 HTTP 请求与响应。",-1),l("p",null,"工作方式：",-1),l("ol",null,[l("li",null,"所有请求和响应都被拆分成小块（frame）。"),l("li",null,"每个请求分配一个唯一的 Stream ID。"),l("li",null,"这些 frame 被交错（交织）发送，在同一个 TCP 连接中同时传输。"),l("li",null,"接收端再根据 Stream ID 把它们拼回原样。")],-1),l("p",null,"举个例子： 假设浏览器要加载三个资源：",-1),l("div",{class:"language-"},[l("button",{title:"Copy Code",class:"copy"}),l("span",{class:"lang"}),l("pre",{class:"shiki shiki-themes github-light github-dark",style:{"--shiki-light":"#24292e","--shiki-dark":"#e1e4e8","--shiki-light-bg":"#fff","--shiki-dark-bg":"#24292e"},tabindex:"0",dir:"ltr"},[l("code",null,[l("span",{class:"line"},[l("span",null,"index.html")]),n(`
`),l("span",{class:"line"},[l("span",null,"style.css")]),n(`
`),l("span",{class:"line"},[l("span",null,"main.js")])])])],-1),l("p",null,"HTTP/1.1：",-1),l("ul",null,[l("li",null,"3 个请求需要占用 3 个 TCP 连接；"),l("li",null,"或者 1 个连接按顺序：html → css → js；"),l("li",null,"前面的慢了，后面的全卡住（队头阻塞）。")],-1),l("p",null,"HTTP/2：",-1),l("ul",null,[l("li",null,"所有请求共用 1 个 TCP 连接；"),l("li",null,"三个请求的 frame 被交错发送；"),l("li",null,"谁先返回数据就先解析，完全并行。")],-1),l("p",null,"多路复用消除了 HTTP 层阻塞，但 TCP 层仍可能受丢包影响。",-1),l("p",null,[l("strong",null,"HTTP/2 多路复用 = 一个连接里同时传多条请求流，互不阻塞，性能飞升。")],-1)])]),_:1}),s[15]||(s[15]=l("h3",{id:"_5-dns-协议",tabindex:"-1"},[n("5. DNS 协议 "),l("a",{class:"header-anchor",href:"#_5-dns-协议","aria-label":"Permalink to “5. DNS 协议”"},"​")],-1)),t(i,null,{default:a(()=>[...s[4]||(s[4]=[l("p",null,"DNS（Domain Name System） 是一个将 域名 ↔ IP 地址 相互映射的分布式系统。",-1),l("p",null,"因为：用户容易记住 www.example.com;计算机只能识别 93.184.216.34;DNS 让我们可以使用域名访问网站，系统自动帮你找到正确的 IP。",-1),l("p",null,"DNS 解析的完整流程:",-1),l("ul",null,[l("li",null,"浏览器缓存: 先查本地 DNS 缓存（比如上次访问过)"),l("li",null,"操作系统缓存: 如果浏览器里没有，就问操作系统的 DNS 缓存。"),l("li",null,"hosts 文件: 操作系统先查 hosts 文件，看看是否有手动配置。"),l("li",null,"本地 DNS 服务器（递归解析器）: 一般由 ISP（网络运营商）提供，比如 8.8.8.8（Google）、114.114.114.114（中国电信）。"),l("li",null,"递归查询（DNS 服务器帮你查到底）")],-1),l("p",null,"DNS 通常使用 UDP 53 端口（查询），TCP 用于传输大数据量（如区域传送）。",-1),l("p",null,"每条 DNS 记录都有一个 TTL（Time To Live） 值，比如 300 秒。",-1)])]),_:1}),s[16]||(s[16]=l("h3",{id:"_6-html-script-defer-与async",tabindex:"-1"},[n("6. html script defer 与async "),l("a",{class:"header-anchor",href:"#_6-html-script-defer-与async","aria-label":"Permalink to “6. html script defer 与async”"},"​")],-1)),t(i,null,{default:a(()=>[...s[5]||(s[5]=[l("table",{tabindex:"0"},[l("thead",null,[l("tr",null,[l("th",null,"特性"),l("th",null,[l("code",null,"<script async> ")]),l("th",null,[l("code",null,"<script defer>")])])]),l("tbody",null,[l("tr",null,[l("td",null,"加载时机 (Loading)"),l("td",null,"立即加载（与 HTML 解析并行）"),l("td",null,"立即加载（与 HTML 解析并行）")]),l("tr",null,[l("td",null,"执行时机 (Execution)"),l("td",null,"文件下载完成后立即执行"),l("td",null,"等待整个 HTML 文档解析完成后再执行")]),l("tr",null,[l("td",null,"执行顺序"),l("td",null,"不保证顺序。哪个文件先下载完，哪个先执行。"),l("td",null,"保证顺序。按在文档中出现的顺序依次执行。")]),l("tr",null,[l("td",null,"是否阻塞 HTML"),l("td",null,"会。文件执行时会暂停 HTML 解析。"),l("td",null,"不会。保证在 HTML 解析完成后才执行。")]),l("tr",null,[l("td",null,"适用场景"),l("td",null,"适用于独立脚本，不依赖 DOM，也不被其他脚本依赖（如统计脚本）。"),l("td",null,"适用于依赖 DOM 或被其他 defer 脚本依赖的脚本（如应用主逻辑脚本）。")])])],-1)])]),_:1}),s[17]||(s[17]=l("h3",{id:"_7-http-3",tabindex:"-1"},[n("7. HTTP/3 "),l("a",{class:"header-anchor",href:"#_7-http-3","aria-label":"Permalink to “7. HTTP/3”"},"​")],-1)),t(i,null,{default:a(()=>[...s[6]||(s[6]=[l("p",null,[l("strong",null,"HTTP/3 = HTTP/2 + QUIC(UDP)")],-1),l("p",null,[n("HTTP/3 是继 HTTP/2 之后的下一代超文本传输协议。它的核心变化是："),l("strong",null,"不再基于 TCP，而是基于 QUIC（UDP 之上的新协议）。")],-1),l("table",{tabindex:"0"},[l("thead",null,[l("tr",null,[l("th",null,"协议"),l("th",null,"传输层"),l("th",null,"特点"),l("th",null,"存在问题")])]),l("tbody",null,[l("tr",null,[l("td",null,[l("strong",null,"HTTP/1.1")]),l("td",null,"TCP"),l("td",null,"简单、可靠"),l("td",null,"多连接、阻塞严重")]),l("tr",null,[l("td",null,[l("strong",null,"HTTP/2")]),l("td",null,"TCP"),l("td",null,"多路复用、头部压缩"),l("td",null,"TCP 队头阻塞无法彻底解决")]),l("tr",null,[l("td",null,[l("strong",null,"HTTP/3")]),l("td",null,[l("strong",null,"UDP（QUIC）")]),l("td",null,"多路复用、内置加密、低延迟"),l("td",null,"部分老设备不兼容 UDP")])])],-1),l("p",null,"QUIC（UDP）的优势",-1),l("p",null,"QUIC 直接运行在 UDP 之上，自己实现可靠传输 + 拥塞控制 + 加密：",-1),l("ul",null,[l("li",null,"消除队头阻塞：每个流独立传输，不互相影响"),l("li",null,"1-RTT 握手（甚至 0-RTT）"),l("li",null,"连接可迁移（基于 Connection ID）"),l("li",null,"内置 TLS 1.3 加密（强制 HTTPS）")],-1),l("div",{class:"language-"},[l("button",{title:"Copy Code",class:"copy"}),l("span",{class:"lang"}),l("pre",{class:"shiki shiki-themes github-light github-dark",style:{"--shiki-light":"#24292e","--shiki-dark":"#e1e4e8","--shiki-light-bg":"#fff","--shiki-dark-bg":"#24292e"},tabindex:"0",dir:"ltr"},[l("code",null,[l("span",{class:"line"},[l("span",null,"// HTTP/2")]),n(`
`),l("span",{class:"line"},[l("span",null,"HTTP/2")]),n(`
`),l("span",{class:"line"},[l("span",null,"  ↓")]),n(`
`),l("span",{class:"line"},[l("span",null,"  TLS")]),n(`
`),l("span",{class:"line"},[l("span",null,"  ↓")]),n(`
`),l("span",{class:"line"},[l("span",null,"  TCP")]),n(`
`),l("span",{class:"line"},[l("span",null,"  ↓")]),n(`
`),l("span",{class:"line"},[l("span",null,"  IP")]),n(`
`),l("span",{class:"line"},[l("span")]),n(`
`),l("span",{class:"line"},[l("span",null,"// HTTP/3")]),n(`
`),l("span",{class:"line"},[l("span",null,"HTTP/3")]),n(`
`),l("span",{class:"line"},[l("span",null,"  ↓")]),n(`
`),l("span",{class:"line"},[l("span",null,"  QUIC (内含TLS 1.3 + 可靠传输)")]),n(`
`),l("span",{class:"line"},[l("span",null,"  ↓")]),n(`
`),l("span",{class:"line"},[l("span",null,"  UDP")]),n(`
`),l("span",{class:"line"},[l("span",null,"  ↓")]),n(`
`),l("span",{class:"line"},[l("span",null,"  IP")])])])],-1)])]),_:1}),s[18]||(s[18]=l("h3",{id:"_8-nginx-proxy-pass-与location-结尾加不加-对路径的影响",tabindex:"-1"},[n("8. nginx proxy_pass 与location 结尾加不加 / 对路径的影响 "),l("a",{class:"header-anchor",href:"#_8-nginx-proxy-pass-与location-结尾加不加-对路径的影响","aria-label":"Permalink to “8. nginx proxy_pass 与location 结尾加不加 / 对路径的影响”"},"​")],-1)),t(i,null,{default:a(()=>[...s[7]||(s[7]=[l("p",null,[l("strong",null,"尾斜杠“决定路径拼接规则”"),n(" ,location 和 proxy_pass 的结尾 是否带 /，直接决定了 Nginx 如何拼接请求路径。")],-1),l("p",null,"proxy_pass 加不加 /:",-1),l("ul",null,[l("li",null,"不加 /：location 匹配的路径会被完整拼接到 proxy_pass 地址后（适合后端接口路径与前端请求路径完全一致的场景）。"),l("li",null,"加 /：location 匹配的路径会被替换为 /，仅将剩余路径拼接到 proxy_pass 地址后（适合需要简化后端接口路径的场景）。")],-1),l("p",null,"参考:",-1),l("table",{tabindex:"0"},[l("thead",null,[l("tr",null,[l("th",{style:{"text-align":"center"}},"情形"),l("th",{style:{"text-align":"left"}},[l("code",null,"location"),n(" 配置")]),l("th",{style:{"text-align":"left"}},[l("code",null,"proxy_pass"),n(" 配置")]),l("th",{style:{"text-align":"left"}},"请求示例"),l("th",{style:{"text-align":"left"}},"转发给上游的路径"),l("th",{style:{"text-align":"left"}},"说明")])]),l("tbody",null,[l("tr",null,[l("td",{style:{"text-align":"center"}},"1"),l("td",{style:{"text-align":"left"}},[l("code",null,"/api"),n("（不带斜杠）")]),l("td",{style:{"text-align":"left"}},[l("code",null,"http://backend"),n("（不带斜杠）")]),l("td",{style:{"text-align":"left"}},[l("code",null,"/api/foo")]),l("td",{style:{"text-align":"left"}},[l("code",null,"http://backend/api/foo")]),l("td",{style:{"text-align":"left"}},[n("保留原始路径 "),l("code",null,"/api/foo"),n("。")])]),l("tr",null,[l("td",{style:{"text-align":"center"}},"2"),l("td",{style:{"text-align":"left"}},[l("code",null,"/api"),n("（不带斜杠）")]),l("td",{style:{"text-align":"left"}},[l("code",null,"http://backend/"),n("（带斜杠）")]),l("td",{style:{"text-align":"left"}},[l("code",null,"/api/foo")]),l("td",{style:{"text-align":"left"}},[l("code",null,"http://backend//foo")]),l("td",{style:{"text-align":"left"}},[n("去除 "),l("code",null,"/api"),n(" 前缀后拼接，产生双斜杠。")])]),l("tr",null,[l("td",{style:{"text-align":"center"}},"3"),l("td",{style:{"text-align":"left"}},[l("code",null,"/api/"),n("（带斜杠）")]),l("td",{style:{"text-align":"left"}},[l("code",null,"http://backend"),n("（不带斜杠）")]),l("td",{style:{"text-align":"left"}},[l("code",null,"/api/foo")]),l("td",{style:{"text-align":"left"}},[l("code",null,"http://backend/api/foo")]),l("td",{style:{"text-align":"left"}},[n("保留 "),l("code",null,"/api/"),n(" 前缀。")])]),l("tr",null,[l("td",{style:{"text-align":"center"}},"4"),l("td",{style:{"text-align":"left"}},[l("code",null,"/api/"),n("（带斜杠）")]),l("td",{style:{"text-align":"left"}},[l("code",null,"http://backend/"),n("（带斜杠）")]),l("td",{style:{"text-align":"left"}},[l("code",null,"/api/foo")]),l("td",{style:{"text-align":"left"}},[l("code",null,"http://backend/foo")]),l("td",{style:{"text-align":"left"}},[n("去除 "),l("code",null,"/api/"),n(" 前缀后拼接，结果 "),l("code",null,"/foo"),n("。")])])])],-1)])]),_:1}),s[19]||(s[19]=l("h3",{id:"_9-nginx多域名隔离-同域名不同路径映射",tabindex:"-1"},[n("9. nginx多域名隔离, 同域名不同路径映射 "),l("a",{class:"header-anchor",href:"#_9-nginx多域名隔离-同域名不同路径映射","aria-label":"Permalink to “9. nginx多域名隔离, 同域名不同路径映射”"},"​")],-1)),t(i,null,{default:a(()=>[...s[8]||(s[8]=[l("p",null,"Nginx 可以通过 include 指令或虚拟主机（vhost）实现前端多环境（如开发、测试、生产）的隔离部署，同时针对同域名不同路径的映射场景，需要处理路径重写和资源引用问题",-1),l("p",null,"多环境隔离的核心是为不同环境（如 dev、test、prod）配置独立的 Nginx 规则，避免互相干扰。",-1),l("ol",null,[l("li",null,"基于 include 指令的多环境配置（推荐）")],-1),l("ul",null,[l("li",null,"适合单服务器部署多个环境，通过拆分配置文件实现隔离，便于维护。"),l("li",null,"也适合单服务部署多域名环境")],-1),l("ol",{start:"2"},[l("li",null,"基于虚拟主机（vhost）的多环境配置")],-1),l("div",{class:"language-nginx"},[l("button",{title:"Copy Code",class:"copy"}),l("span",{class:"lang"},"nginx"),l("pre",{class:"shiki shiki-themes github-light github-dark",style:{"--shiki-light":"#24292e","--shiki-dark":"#e1e4e8","--shiki-light-bg":"#fff","--shiki-dark-bg":"#24292e"},tabindex:"0",dir:"ltr"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"http"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    # 开发环境（域名区分）")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    server"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        listen "),l("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"80"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        server_name "),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"dev.example.com;  "),l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# 开发环境域名")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        root "),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"/path/to/frontend/dev;")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        # ... 其他配置（路由、代理等）")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),n(`
`),l("span",{class:"line"}),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    # 测试环境（端口区分）")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    server"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        listen "),l("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"8081"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";  "),l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# 测试环境端口")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        server_name "),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"localhost;")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        root "),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"/path/to/frontend/test;")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        # ... 其他配置")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),n(`
`),l("span",{class:"line"}),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    # 生产环境（HTTPS）")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    server"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        listen "),l("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"443"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ssl;")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        server_name "),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"example.com;  "),l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# 生产环境域名")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        root "),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"/path/to/frontend/prod;")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        # ... SSL 配置和其他生产环境特有的规则")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])])],-1),l("p",null,"同域名不同路径映射的重写问题及解决方案",-1),l("p",null,"当多个前端应用部署在同一域名的不同路径下（如 example.com/app1、example.com/app2），需要解决路径映射和资源引用的问题。",-1),l("div",{class:"language-nginx"},[l("button",{title:"Copy Code",class:"copy"}),l("span",{class:"lang"},"nginx"),l("pre",{class:"shiki shiki-themes github-light github-dark",style:{"--shiki-light":"#24292e","--shiki-dark":"#e1e4e8","--shiki-light-bg":"#fff","--shiki-dark-bg":"#24292e"},tabindex:"0",dir:"ltr"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"server"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    listen "),l("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"80"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    server_name "),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"example.com;")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    root "),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"/var/www;  "),l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# 父目录")]),n(`
`),l("span",{class:"line"}),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    # 应用 A：匹配 /app1 路径")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    location"),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," /app1 "),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"{")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        # 实际文件目录为 /var/www/app1")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        alias "),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"/var/www/app1;  "),l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# 注意：这里用 alias 而非 root（关键区别）")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        index "),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"index.html;")]),n(`
`),l("span",{class:"line"}),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        # 解决 History 路由刷新 404")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        try_files "),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$uri $uri/ /app1/index.html;")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),n(`
`),l("span",{class:"line"}),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    # 应用 B：匹配 /app2 路径")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    location"),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," /app2 "),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"{")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        alias "),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"/var/www/app2;")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        index "),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"index.html;")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        try_files "),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$uri $uri/ /app2/index.html;")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])])],-1),l("p",null,"关键区别：alias vs root",-1),l("p",null,"root /var/www：请求 /app1/static/css.css 会映射到 /var/www/app1/static/css.css（拼接完整路径）。 alias /var/www/app1：请求 /app1/static/css.css 会直接映射到 /var/www/app1/static/css.css（替换 /app1 为实际目录），更适合子路径部署。",-1)])]),_:1}),s[20]||(s[20]=l("h3",{id:"_10-websocket",tabindex:"-1"},[n("10. WebSocket "),l("a",{class:"header-anchor",href:"#_10-websocket","aria-label":"Permalink to “10. WebSocket”"},"​")],-1)),t(i,null,{default:a(()=>[...s[9]||(s[9]=[l("p",null,"WebSocket是HTML5提供的一种浏览器与服务器进行全双工通讯的网络技术，属于应用层协议。它基于TCP传输协议，并复用HTTP的握手通道。浏览器和服务器只需要完成一次握手，两者之间就直接可以创建持久性的连接， 并进行双向数据传输。",-1),l("p",null,[n("WebSocket 的出现就解决了半双工通信的弊端。它最大的特点是："),l("strong",null,"服务器可以向客户端主动推动消息，客户端也可以主动向服务器推送消息。")],-1),l("p",null,"WebSocket 特点的如下：",-1),l("ul",null,[l("li",null,"支持双向通信，实时性更强"),l("li",null,"可以发送文本，也可以发送二进制数据‘’"),l("li",null,"建立在TCP协议之上，服务端的实现比较容易"),l("li",null,"数据格式比较轻量，性能开销小，通信高效"),l("li",null,"没有同源限制，客户端可以与任意服务器通信"),l("li",null,"协议标识符是ws（如果加密，则为wss），服务器网址就是 URL"),l("li",null,"与 HTTP 协议有着良好的兼容性。默认端口也是80和443，并且握手阶段采用 HTTP 协议，因此握手时不容易屏蔽，能通过各种 HTTP 代理服务器。"),l("li",null,"连接通过 HTTP Upgrade 握手升级而来。")],-1)])]),_:1}),s[21]||(s[21]=l("h3",{id:"_11-短轮询、长轮询、sse-和-websocket",tabindex:"-1"},[n("11. 短轮询、长轮询、SSE 和 WebSocket "),l("a",{class:"header-anchor",href:"#_11-短轮询、长轮询、sse-和-websocket","aria-label":"Permalink to “11. 短轮询、长轮询、SSE 和 WebSocket”"},"​")],-1)),t(i,null,{default:a(()=>[...s[10]||(s[10]=[l("table",{tabindex:"0"},[l("thead",null,[l("tr",null,[l("th",null,"特性"),l("th",null,"短轮询"),l("th",null,"长轮询"),l("th",null,"SSE"),l("th",null,"WebSocket")])]),l("tbody",null,[l("tr",null,[l("td",null,"协议"),l("td",null,"HTTP"),l("td",null,"HTTP"),l("td",null,"HTTP（text/event-stream）"),l("td",null,"专用 WS 协议（基于 TCP）")]),l("tr",null,[l("td",null,"实时性"),l("td",null,"⏱ 延迟高"),l("td",null,"⚡ 中等"),l("td",null,"⚡ 高"),l("td",null,"🚀 最高")]),l("tr",null,[l("td",null,"方向"),l("td",null,"客户端拉取"),l("td",null,"客户端拉取"),l("td",null,"服务端推送"),l("td",null,"双向")]),l("tr",null,[l("td",null,"兼容性"),l("td",null,"✅ 最好"),l("td",null,"✅ 好"),l("td",null,"⚠️ IE 不支持"),l("td",null,"⚠️ 需服务器支持")]),l("tr",null,[l("td",null,"连接数量"),l("td",null,"多"),l("td",null,"多（长时间挂起）"),l("td",null,"少（单连接）"),l("td",null,"少（持久连接）")]),l("tr",null,[l("td",null,"复杂度"),l("td",null,"⭐ 简单"),l("td",null,"⭐⭐ 中等"),l("td",null,"⭐⭐ 中等"),l("td",null,"⭐⭐⭐ 高")]),l("tr",null,[l("td",null,"常见场景"),l("td",null,"定时刷新数据"),l("td",null,"即时消息、通知"),l("td",null,"日志推送、股票行情"),l("td",null,"聊天、游戏、协同编辑")])])],-1),l("table",{tabindex:"0"},[l("thead",null,[l("tr",null,[l("th",null,"场景"),l("th",null,"推荐方式"),l("th",null,"理由")])]),l("tbody",null,[l("tr",null,[l("td",null,"定时刷新、后台任务"),l("td",null,"短轮询"),l("td",null,"简单可靠")]),l("tr",null,[l("td",null,"实时通知、消息提醒"),l("td",null,"长轮询 / SSE"),l("td",null,"实时性高，易于部署")]),l("tr",null,[l("td",null,"实时图表、日志流"),l("td",null,"SSE"),l("td",null,"单向推送、易实现")]),l("tr",null,[l("td",null,"聊天、多人协作、游戏, 消息"),l("td",null,"WebSocket"),l("td",null,"双向实时通信能力强")])])],-1),l("ul",null,[l("li",null,"短轮询: 每隔短时间询问服务器"),l("li",null,"长轮询: 浏览器发送请求后，服务器不立即返回，而是等到有新数据再响应，或者超时（例如 30s）。浏览器收到响应后立即发起下一次请求，保持“几乎实时”。"),l("li",null,"SSE: 服务器通过 HTTP 长连接 向浏览器“持续推送”数据（单向）。('Content-Type': 'text/event-stream')"),l("li",null,"WebSocket 是 全双工通信协议，一旦连接建立，客户端和服务器都可以主动发送消息。")],-1)])]),_:1}),s[22]||(s[22]=l("h3",{id:"_11-tcp-和-udp",tabindex:"-1"},[n("11. TCP 和 UDP "),l("a",{class:"header-anchor",href:"#_11-tcp-和-udp","aria-label":"Permalink to “11. TCP 和 UDP”"},"​")],-1)),t(i),s[23]||(s[23]=h('<h3 id="其他" tabindex="-1">其他 <a class="header-anchor" href="#其他" aria-label="Permalink to “其他”">​</a></h3><ul><li><p>HTTP/1.1</p><ul><li>特点: 持久连接 (Keep-Alive);管道化 (Pipelining);多连接并发;头部冗余;</li><li>问题: 队头阻塞、连接利用率低、头部冗余。</li></ul></li><li><p>HTTP2</p><ul><li>特点: 二进制分帧 (Binary Framing);多路复用 (Multiplexing);头部压缩 (HPACK);服务端推送 (Server Push);</li><li>改进点：减少延迟、提升带宽利用率。</li><li>问题: 因为仍然基于 TCP，丢包时所有流都要等，TCP 层仍然存在 队头阻塞</li></ul></li><li><p>HTTP/3</p><ul><li>特点: 基于 QUIC 协议（UDP 上实现）;内置 TLS 1.3 加密;更快的连接建立;多路复用天然支持;</li></ul></li><li><p>TLS/SSL: 加密（防止窃听）;身份认证（确认服务端身份）;完整性校验（防止篡改）</p></li><li><p>HTTPS 是在 HTTP 与 TCP 之间加入了TLS/SSL层，保证了通信的安全性。它通过数字证书验证服务器身份，用非对称加密实现安全的密钥交换，然后使用对称加密进行高效的数据传输。TLS 1.3 相比 TLS 1.2，减少了握手延迟并提升了安全性。</p></li><li><p>TLS 握手过程: ClientHello(浏览器发起握手，请求支持的加密算法、随机数), ServerHello(服务器选择加密算法，返回随机数和 数字证书（包含公钥）),验证证书(浏览器验证证书是否可信（CA 签发、域名匹配、未过期）), 密钥交换(浏览器用服务器公钥加密一个“对称会话密钥”，发给服务器。服务器用私钥解密，拿到对称密钥。), 建立安全通信(后续通信用对称加密（如 AES, ECC），保证性能)</p></li><li><p>TCP 特点: 传输控制协议：面向连接的，可靠的，基于字节流的传输层通信协议.(基于连接的,字节流,流量缓冲,可靠的传输服务,拥塞控制)</p></li><li><p>SYN: 握手, ACK 应答, FIN 断开</p></li></ul>',2))])}const P=e(r,[["render",k]]);export{b as __pageData,P as default};
